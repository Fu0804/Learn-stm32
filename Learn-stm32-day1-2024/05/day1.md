# Learn-stm32-day1-2024/05/07
## STM32简介
STM32是ST公司基于ARM Cortex-M内核开发的32位微控制器，功能强大，其常用于嵌入式领域。  
<div align=center>
<img src="https://github.com/Fu0804/Learn-stm32/assets/151499353/89d91ae5-e450-482a-872e-7822b5405f61">
</div>

#### 本次学习所用STM32芯片参数：  
* 系列：主流系列STM32F1
* 内核:ARM Cortex-M3
* 主频:72MHz
* RAM:20K (SRAM)
* ROM :64K (Flash)
* 供电:2.0~3.6V (标准3.3V)
* 封装:LQFP48
  
#### 片上资源/外设：
<div align=center>
<img src="https://github.com/Fu0804/Learn-stm32/assets/151499353/5b3a45f0-74f3-44ff-9a6c-8e9fef0498b3">
</div>

#### 命名规则：
本次学习所用stm32系列芯片命名如下，其他型号也可参照此规则命名。
<div align=center>
<img src="https://github.com/Fu0804/Learn-stm32/assets/151499353/a509f847-a062-4405-82f6-40f8204ab358">
</div>

#### 系统结构
<div align=center>
<img src="https://github.com/Fu0804/Learn-stm32/assets/151499353/eb912069-cc1b-42fc-95bd-1e680cf5c957">
</div>
  
* 其中Cortex-M3为系统内核，ICode为指令总线，DCode为数据总线，System为系统总线。Flash中存储着我们编写的程序，ICode指令总线用于加载程序指令，DCode数据总线用于加载程序数据。  
* SRAM用于存储程序运行时的变量数据；FSMC此次学习用不到；AHB系统总线，即先进高性能总线，用于挂载最基本以及性能比较高的外设；APB先进外设总线，用于连接一般的外设，由桥接所连接。  
* AHB与APB受总线协议、总线速度、数据传输格式差异，需要使用桥接完成数据转换与缓存。AHB与APB2为72MHz，APB1一般为36MHz，也因此APB2连接更加重要的外设。  
* DMA1与DMA2用于协助CPU工作，提高工作效率，处理数据搬运等简单且重复性任务。  

#### 引脚定义
<div align=center>
<img src="https://github.com/Fu0804/Learn-stm32/assets/151499353/f661d0c8-6f78-436d-a0e7-9622edc914ba">
</div>

* 其中标红为电源相关引脚，标蓝为最小系统相关引脚，标绿为IO口、功能口相关引脚。
* 类型列，S表示电源，I代表输入，O代表输出，I-O代表输入输出。
* I/O电平列，表示IO口所能容忍的电压，FT表示能容忍5V电压，没有FT能容忍3.3V的电压。如没有FT需要5V电平，需要加装电平转换电路。
* 主动能列表示上电后默认功能，默认复用功能列表示IO口上同时连接的外设功能引脚，重定义功能列用于当两个功能同时复用在一个IO口上，且同时需要这两个功能，可以把其中一个功能重映射到其他端口上。
##### 具体引脚定义
**注：IO口优先使用加粗IO口，没有加粗的IO口需要配置或兼备其他功能。**  
* 1，VBAT，备用电池供电引脚，可接一3V电池，当系统电源断电时，备用电池可以给内部的RTC时钟和备份寄存器提供电源
* 2，IO口/侵入检测/RTC，根据程序输出或读取高低电平，侵入检测用于做安全保障的功能，RTC引脚用于做RTC校准时钟、RTC闹钟时钟或者秒脉冲
* 3、4，IO口/32.768kHz的RTC晶振
* 5、6，系统主晶振，一般为8MHz，通过使用芯片内锁相环电路，对该8MHz频率进行倍频，产生72MHz频率，作为系统主时钟
* 7，NRST，系统复位引脚，N代表低电平复位
* 8、9，内部模拟部分电源，ADC、RC震荡器等。VSS为负极，接GND；VDD为正极，接3.3V
* 10~19，IO口，其中PA0兼具WKUP功能，用于唤醒处于待机模式的STM32
* 20，IO口或着BOOT1引脚，BOOT引脚用于配置启动模式
* 21、22，IO口
* 23~24、35~36、47~48，为系统的主电源口，其中VSS为负极，VDD为正极。使用时，一般VSS接地，VDD接3.3V即可。
* 25~33，IO口
* 34、37~40，IO口或调试端口，主动能为默认调试端口，用于调试程序及下载程序。**STM32支持SWD和JTAG两种调试方式，学习教程使用STLINK下载调试程序。STLINK采用SWD方式，所以只需占用PA13、PA14两端口，剩下PA15、PB3、PB4可以切换为普通IO口使用，但需在程序中配置以使用**
* 41~43、45~46，IO口
* 44，BOOT0，用于做启动配置

#### 启动配置
<div align=center>
<img src="https://github.com/Fu0804/Learn-stm32/assets/151499353/80cca053-7cbf-4727-ada7-a5480fa08be2">
</div>
  
启动配置用于指定程序开始运行的位置。一般情况下，程序在Flash程序存储器开始执行；某些情况下，我们也可以让其在别的地方开始执行，完成特殊的功能。  
主闪存存储器启动模式为最常用启动模式；系统存储器启动模式一般作为串口下载使用，系统存储所存储的为STM32中一段BootLoader程序，其作用为接收串口的数据，然后刷新到主闪存中；内置SRAM启动模式用于程序调试，用的比较少。  
另外，在上电一瞬间为BOOT功能，第四个时钟后，便可做普通IO口功能。

#### 最小系统电路
<div align=center>
<img src="https://github.com/Fu0804/Learn-stm32/assets/151499353/09c9ccf6-8078-4d20-939d-947c6e0546c7">
</div>

**供电电路**
使STM32能进行工作的最基本的电路为最小系统电路，具体可见上图。  
其中，供电电路的C4、C5、C6、C7电容为滤波电容，用于保证供电电压稳定（**很有必要**）。在设计电路中，如果遇到供电，一般都会使用滤波电容。另外，1号备用电池引脚有必要可接上，但由于同时也为RTC及备份寄存器服务，如果需要这些功能，则无需接备用电池，引脚悬空即可。  

**晶振电路**  
##### PS：什么是晶振电路？
参考网址：[秒懂单片机晶振电路原理 - 知乎](https://zhuanlan.zhihu.com/p/72583737)[什么是晶振？晶振的原理及作用是什么？一篇文章带你了解晶振 - 知乎](https://zhuanlan.zhihu.com/p/526858084)
- 晶振是电路中常用用的时钟元件，全称是叫晶体震荡器，通过一定的外接电路可以生成频率和峰值稳定的正弦波。其在单片机系统里晶振的作用非常大，他结合单片机内部的电路，产生单片机所必须的时钟频率，单片机的一切指令的执行都是建立在这个基础上的，晶振的提供的时钟频率越高，那单片机的运行速度也就越快。
- 单片机在运行时需要一个脉冲信号，作为指令执行的触发信号。在电路中，为了产生该脉冲信号，首先需得到交流信号，可以用RC、LC谐振电路取得，但这些电路的振荡频率并不稳定。在要求得到高稳定频率的电路中，必须使用石英晶体振荡电路。石英晶体具有高品质因数，振荡电路采用了恒温、稳压等方式以后，振荡频率稳定度可以达到10^（-9）至10^（-11）。广泛应用在通讯、时钟、手表、计算机……需要高稳定信号的场合。
- 该芯片具体产生时钟频率的使用晶振的振荡电路即为上图所示。

**PS:**如果想要生成1s的时钟信号，还需要再接一个32.768kHz的晶振，电路与上图一致，接在3，4号引脚。  

**复位电路**  
NRST接于单片机7号引脚，用于给单片机复位。设备死机不方便重启时可复位，程序从头开始运行。上电一瞬间产生低电平复位信号实现单片机复位，另外，也可以通过K1按键实现手动复位。  

**启动配置**  
在该板子中，使用跳线帽来实现配置BOOT的高低电平。  

**下载端口**  
使用STLINK下载程序的话SWDIO、SWCLK引脚需连接好。  

#### 核心板原理图
本次学习使用STM32最小系统板来学习，已经包含一部分最小系统电路，如下。  
<div align=center>
<img src="https://github.com/Fu0804/Learn-stm32/assets/151499353/8433a45a-a4b3-49f9-b81c-9e35c9e87647">
</div>

#### 实物图
<div align=center>
<img src="https://github.com/Fu0804/Learn-stm32/assets/151499353/d5401ce1-4b18-40af-b9f7-9e111cf3bc37">
</div>

<div align=center>
<img src="https://github.com/Fu0804/Learn-stm32/assets/151499353/b2c5c7e7-1bad-458a-a518-947b8a2bdbf5">
</div>

## 软件安装
### 安装Keil5 MDK
依照视频教程安装即可。

